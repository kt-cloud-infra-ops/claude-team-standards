# Luppiter Web - ๋ก๊ทธ์ธ ๋ฐ ์ธ์ ๊ด๋ฆฌ ๊ฐ์ด๋

## ๐ ๊ฐ์

Luppiter Web ์์คํ์ ์ธ์ ๊ธฐ๋ฐ ์ธ์ฆ์ ์ฌ์ฉํฉ๋๋ค. API ํ์คํธ๋ฅผ ์ํด์๋ ๋จผ์ ๋ก๊ทธ์ธ์ ํตํด ์ธ์ ID๋ฅผ ๋ฐ๊ธ๋ฐ๊ณ, ์ดํ ๋ชจ๋ API ์์ฒญ์ ์ด ์ธ์์ ํฌํจํด์ผ ํฉ๋๋ค.

## ๐ ์ธ์ฆ ๋ฐฉ์

### 1. ์ธ์ ๊ธฐ๋ฐ ์ธ์ฆ
- **์ธ์ ID**: `JSESSIONID` ์ฟํค๋ก ๊ด๋ฆฌ
- **์ธ์ ์์ฅ์**: ์๋ฒ ๋ฉ๋ชจ๋ฆฌ + ๋ฐ์ดํฐ๋ฒ์ด์ค
- **์ธ์ ํ์์์**: 30๋ถ (์ค์ ๊ฐ๋ฅ)

### 2. ๋ก๊ทธ์ธ ๋ฐฉ์
- **์ผ๋ฐ ๋ก๊ทธ์ธ**: `/api/ctl/login`
- **LDAP ๋ก๊ทธ์ธ**: `/api/ctl/ldapLogin`

## ๐ ์ฌ์ฉ ๋ฐฉ๋ฒ

### 1. Postman์์ ์ฌ์ฉ

#### 1.1 ์ปฌ๋์ Import
```bash
# evt_api_collection_with_login.json ํ์ผ์ Postman์ import
```

#### 1.2 ํ๊ฒฝ ๋ณ์ ์ค์
- `baseUrl`: ์๋ฒ URL (์: http://localhost:8080)
- `sessionId`: ๋ก๊ทธ์ธ ํ ์๋์ผ๋ก ์ค์๋จ
- `userId`: ๋ก๊ทธ์ธ ํ ์๋์ผ๋ก ์ค์๋จ

#### 1.3 ๋ก๊ทธ์ธ ์์
1. **Authentication** ํด๋์ **๋ก๊ทธ์ธ** API ์คํ
2. ์ฑ๊ณต ์ ์ธ์ ID๊ฐ ์๋์ผ๋ก ์์ฅ๋จ
3. ์ดํ ๋ชจ๋ API ์์ฒญ์ ์ธ์์ด ์๋์ผ๋ก ํฌํจ๋จ

#### 1.4 ๋ก๊ทธ์ธ ์์ฒญ ์์
```json
POST {{baseUrl}}/api/ctl/login
Content-Type: application/x-www-form-urlencoded

loginId=test_user&loginPassword=test_password
```

#### 1.5 ๋ก๊ทธ์ธ ์๋ต ์์
```json
{
  "resCode": "200",
  "resMsg": "๋ก๊ทธ์ธ ์ฑ๊ณต",
  "info": {
    "user_id": "test_user",
    "user_name": "ํ์คํธ ์ฌ์ฉ์",
    "user_group": "๊ด์๋ด๋น์",
    "user_depart": "๊ด์ํ",
    "user_exception": "N"
  }
}
```

### 2. Python ์คํฌ๋ฆฝํธ์์ ์ฌ์ฉ

#### 2.1 ๋ก๊ทธ์ธ ํจ์ ์ถ๊ฐ
```python
def login_and_get_session(self, username: str, password: str) -> bool:
    """๋ก๊ทธ์ธ์ ์ํํ๊ณ ์ธ์์ ์ค์ํฉ๋๋ค."""
    login_data = {
        "loginId": username,
        "loginPassword": password
    }
    
    try:
        response = self.session.post(
            f"{self.base_url}/api/ctl/login",
            data=login_data,
            timeout=30
        )
        
        if response.status_code == 200:
            data = response.json()
            if data.get("resCode") == "200":
                # ์ธ์ ์ฟํค ์๋ ์์ฅ
                self.session.cookies.update(response.cookies)
                logger.info(f"๋ก๊ทธ์ธ ์ฑ๊ณต: {data['info']['user_name']}")
                return True
            else:
                logger.error(f"๋ก๊ทธ์ธ ์คํจ: {data.get('resMsg')}")
                return False
        else:
            logger.error(f"HTTP ์ค๋ฅ: {response.status_code}")
            return False
            
    except Exception as e:
        logger.error(f"๋ก๊ทธ์ธ ์ค ์ค๋ฅ ๋ฐ์: {str(e)}")
        return False
```

#### 2.2 ์๋ฐ์ดํธ๋ ํ์คํธ ์คํฌ๋ฆฝํธ
```python
# evt_api_test_automation.py์ ์ถ๊ฐ
def __init__(self, base_url: str = "http://localhost:8080", 
             username: str = None, password: str = None):
    self.base_url = base_url
    self.username = username
    self.password = password
    self.session = requests.Session()
    self.test_results: List[TestResult] = []
    
    # ๊ธฐ๋ณธ ํค๋ ์ค์
    self.session.headers.update({
        'Content-Type': 'application/json',
        'User-Agent': 'EVT-API-Tester/1.0'
    })
    
    # ๋ก๊ทธ์ธ ์๋ณด๊ฐ ์๊ณต๋ ๊ฒฝ์ฐ ์๋ ๋ก๊ทธ์ธ
    if username and password:
        self.login_and_get_session(username, password)

def run_all_tests(self) -> Dict[str, Any]:
    """๋ชจ๋ ํ์คํธ ์คํ"""
    logger.info("=== EVT API ํ์คํธ ์์ ===")
    
    # ๋ก๊ทธ์ธ ์ฒดํฌ
    if not self.is_logged_in():
        logger.warning("๋ก๊ทธ์ธ์ด ํ์ํฉ๋๋ค. ๋จผ์ ๋ก๊ทธ์ธ์ ์ํํ์ธ์.")
        return {
            "error": "๋ก๊ทธ์ธ์ด ํ์ํฉ๋๋ค",
            "total_tests": 0,
            "successful_tests": 0,
            "failed_tests": 0,
            "success_rate": 0
        }
    
    # ๊ธฐ์กด ํ์คํธ ๋ก์ง...
```

### 3. ApipDog์์ ์ฌ์ฉ

#### 3.1 ํ๊ฒฝ ์ค์
```json
{
  "baseUrl": "http://localhost:8080",
  "sessionId": "",
  "userId": ""
}
```

#### 3.2 Pre-request Script (๋ก๊ทธ์ธ์ฉ)
```javascript
// ๋ก๊ทธ์ธ API ํธ์ถ ํ ์ธ์ ์์ฅ
pm.sendRequest({
    url: pm.collectionVariables.get("baseUrl") + "/api/ctl/login",
    method: 'POST',
    header: {
        'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: {
        mode: 'urlencoded',
        urlencoded: [
            {key: "loginId", value: "test_user"},
            {key: "loginPassword", value: "test_password"}
        ]
    }
}, function (err, response) {
    if (response.code === 200) {
        var data = response.json();
        if (data.resCode === "200") {
            // ์ธ์ ID ์์ฅ
            pm.collectionVariables.set("sessionId", response.cookies.get("JSESSIONID"));
            pm.collectionVariables.set("userId", data.info.user_id);
        }
    }
});
```

## ๐ง ์ธ์ ๊ด๋ฆฌ

### 1. ์ธ์ ์ฒดํฌ
```bash
POST {{baseUrl}}/api/ctl/checkSession
Content-Type: application/x-www-form-urlencoded

loginId={{userId}}&sessionId={{sessionId}}
```

### 2. ์ธ์ ๊ฐฑ์
- ์ธ์์ 30๋ถ ํ ์๋ ๋ง๋ฃ
- ๋ง๋ฃ ์ ์ฌ๋ก๊ทธ์ธ ํ์
- ์ค๋ณต ๋ก๊ทธ์ธ ์ ๊ธฐ์กด ์ธ์ ๋ฌดํจํ

### 3. ๋ก๊ทธ์์
```bash
GET {{baseUrl}}/view/ctl/logout
```

## โ๏ธ ์ฃผ์์ฌํญ

### 1. ๋ณด์
- **๋น๋ฐ๋ฒํธ**: SHA-256์ผ๋ก ์ํธํ๋์ด ์์ก
- **์ธ์**: HttpOnly ์ฟํค๋ก ๊ด๋ฆฌ
- **์ค๋ณต ๋ก๊ทธ์ธ**: ๋์ผ ์ฌ์ฉ์์ ๊ธฐ์กด ์ธ์ ๋ฌดํจํ

### 2. ๊ถํ ์ฒดํฌ
- **๊ด์๋ด๋น์**: ๋ชจ๋ ๊ธฐ๋ฅ ์๊ทผ ๊ฐ๋ฅ
- **๊ด์์**: ์ํ๋ ๊ธฐ๋ฅ๋ง ์๊ทผ
- **์ฌ์ฉ์**: ์ฝ๊ธฐ ์์ฉ ๊ธฐ๋ฅ๋ง ์๊ทผ

### 3. ์ค๋ฅ ์ฒ๋ฆฌ
```json
// ๋ก๊ทธ์ธ ์คํจ ์๋ต
{
  "resCode": "400",
  "resMsg": "๋ก๊ทธ์ธ ์๋ณด๋ฅผ ํ์ธํด์ฃผ์ธ์."
}

// ์ธ์ ๋ง๋ฃ ์๋ต
{
  "resCode": "401",
  "resMsg": "์ธ์์ด ๋ง๋ฃ๋์์ต๋๋ค."
}
```

## ๐๏ธ ๋ฌธ์ ํด๊ฒฐ

### 1. ๋ก๊ทธ์ธ ์คํจ
- ์ฌ์ฉ์ ID/๋น๋ฐ๋ฒํธ ํ์ธ
- ๊ณ์ ์ํ ํ์ธ (์ฌ์ฉ/๋ฏธ์ฌ์ฉ/์น์ธ๋๊ธฐ)
- ์๋ฒ ์ฐ๊ฒฐ ์ํ ํ์ธ

### 2. ์ธ์ ๋ง๋ฃ
- 30๋ถ ํ ์๋ ๋ง๋ฃ
- ์ฌ๋ก๊ทธ์ธ ํ์
- ์ค๋ณต ๋ก๊ทธ์ธ ์ ๊ธฐ์กด ์ธ์ ๋ฌดํจํ

### 3. ๊ถํ ์ค๋ฅ
- ์ฌ์ฉ์ ๊ทธ๋ฃน ํ์ธ
- ํ์ํ ๊ถํ์ด ์๋์ง ํ์ธ
- ๊ด๋ฆฌ์์๊ฒ ๋ฌธ์

## ๐ ํ์คํธ ์๋๋ฆฌ์ค

### 1. ๊ธฐ๋ณธ ํ์คํธ ํ๋ก์ฐ
1. ๋ก๊ทธ์ธ API ํธ์ถ
2. ์ธ์ ID ํ์ธ
3. ์ด๋ฒคํธ ๋ชฉ๋ก ์กฐํ
4. ์ด๋ฒคํธ ์์ธ ์๋ณด ์กฐํ
5. ๋ก๊ทธ์์

### 2. ๊ถํ๋ณ ํ์คํธ
- **๊ด์๋ด๋น์**: ๋ชจ๋ CRUD ์์ ํ์คํธ
- **๊ด์์**: ์ฝ๊ธฐ/์์ ์์ ํ์คํธ
- **์ฌ์ฉ์**: ์ฝ๊ธฐ ์์ฉ ์์ ํ์คํธ

### 3. ์ธ์ ํ์คํธ
- ๋ก๊ทธ์ธ โ ์ธ์ ์ฒดํฌ โ API ํธ์ถ โ ๋ก๊ทธ์์
- ์ธ์ ๋ง๋ฃ ์๋๋ฆฌ์ค ํ์คํธ
- ์ค๋ณต ๋ก๊ทธ์ธ ์๋๋ฆฌ์ค ํ์คํธ

## ๐ ์๋ํ ์คํฌ๋ฆฝํธ ์๋ฐ์ดํธ

๊ธฐ์กด `evt_api_test_automation.py`์ ๋ก๊ทธ์ธ ๊ธฐ๋ฅ์ ์ถ๊ฐํ๋ค๋ฉด:

```bash
# ๋ก๊ทธ์ธ ์๋ณด์ ํจ๊ป ์คํ
python evt_api_test_automation.py \
  --base-url http://localhost:8080 \
  --username test_user \
  --password test_password \
  --output test_results.json
```

์ด๋๊ฒ ํ๋ฉด ์๋์ผ๋ก ๋ก๊ทธ์ธ์ ์ํํ๊ณ ์ธ์์ ์์งํ ์ํ์์ ๋ชจ๋ API๋ฅผ ํ์คํธํ ์ ์์ต๋๋ค. 