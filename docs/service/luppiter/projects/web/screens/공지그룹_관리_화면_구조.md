# Luppiter Web - 공지그룹 관리 화면 구조

## 개요

본 문서는 Luppiter Web의 **공지그룹 관리** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/view/ctl/subControlContact`
- **JSP 파일**: `ctl/subControlContact.jsp`
- **Controller**: `CtlController.java`
- **REST Controller**: `CtlRestController.java`
- **설명**: 관제 운영 관리 > 공지그룹 관리(SMS, Email)

---

## 화면 구성 요소

### 1. 헤더 영역
- **제목**: 공지그룹 관리

### 2. 왼쪽 패널 (`panel`, width:42%)
- **제목**: 공지그룹 사용자 관리
- **Toast UI Grid**: `gridUser`
- **페이지 크기 선택**: `slcPageSize` (25, 50, 75, 100, 200, 300)
- **액션 버튼**:
  - 사용자추가: `test-bt-popup1`
- **페이징**: `divPagingUser`

### 3. 오른쪽 패널 (`panel`, width:48%)
- **제목**: 공지 발송 규칙
- **Toast UI Grid**: `gridSms`
- **페이지 크기 선택**: `slcPageSize` (25, 50, 75, 100, 200, 300)
- **액션 버튼**:
  - 발송규칙 추가: `test-bt-popup2`
- **페이징**: `divPagingSms`

### 4. 팝업
- **사용자추가 팝업**: `test-popup1`
- **발송규칙 추가 팝업**: `test-popup2`

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► CtlController.subControlNotice()
        └─► subControlContact.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► 화면 초기화 함수 호출
        ├─► 공지그룹 사용자 그리드 초기화
        ├─► 공지 발송 규칙 그리드 초기화
        └─► 첫 페이지 조회
```

#### 주요 코드 위치
- **컨트롤러**: `CtlController.java:84-95`
- **JSP**: `ctl/subControlContact.jsp`

### 2단계: 공지그룹 사용자 목록 조회

```
[조회 요청]
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/ctl/smsUserList
        ├─► 파라미터 구성
        │   └─► 페이지 정보 (pageNum, pageSize)
        │
        └─► 응답 데이터
            ├─► 공지그룹 사용자 목록 (list)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        └─► gridUser.resetData(data.list)
```

#### 주요 코드 위치
- **조회 함수**: `subControlContact.jsp:공지그룹 사용자 목록 조회 함수`
- **API 호출**: `CtlRestController.java:smsUserList API`

### 3단계: 공지 발송 규칙 목록 조회

```
[조회 요청]
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/ctl/smsList
        ├─► 파라미터 구성
        │   └─► 페이지 정보 (pageNum, pageSize)
        │
        └─► 응답 데이터
            ├─► 공지 발송 규칙 목록 (list)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        └─► gridSms.resetData(data.list)
```

#### 주요 코드 위치
- **조회 함수**: `subControlContact.jsp:공지 발송 규칙 목록 조회 함수`
- **API 호출**: `CtlRestController.java:smsList API`

### 4단계: 공지그룹 사용자 관리

```
[사용자추가 버튼 클릭]
    │
    └─► 사용자추가 팝업 오픈
        └─► POST /api/ctl/insertSmsUser
            └─► 공지그룹 사용자 등록

    ▼

[사용자 수정]
    │
    └─► 그리드 행의 수정 버튼 클릭
        └─► POST /api/ctl/smsUpdateUser
            └─► 공지그룹 사용자 수정

    ▼

[사용자 삭제]
    │
    └─► 그리드 행의 삭제 버튼 클릭
        └─► POST /api/ctl/smsUserDelete
            └─► 공지그룹 사용자 삭제
```

### 5단계: 공지 발송 규칙 관리

```
[발송규칙 추가 버튼 클릭]
    │
    └─► 발송규칙 추가 팝업 오픈
        └─► POST /api/ctl/insertSmsRule
            └─► 공지 발송 규칙 등록

    ▼

[발송규칙 수정]
    │
    └─► 그리드 행의 수정 버튼 클릭
        └─► POST /api/ctl/smsUpdate
            └─► 공지 발송 규칙 수정

    ▼

[발송규칙 삭제]
    │
    └─► 그리드 행의 삭제 버튼 클릭
        └─► POST /api/ctl/smsDelete
            └─► 공지 발송 규칙 삭제
```

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 컨트롤러 | 권한 | 설명 |
|-----|--------|------------|----------|------|------|
| 공지그룹 사용자 목록 조회 | POST | `/api/ctl/smsUserList` | CtlRestController | 모든 권한 | 공지그룹 사용자 목록 조회 |
| 공지그룹 사용자 등록 | POST | `/api/ctl/insertSmsUser` | CtlRestController | 관제담당자, 관제자 | 공지그룹 사용자 등록 |
| 공지그룹 사용자 수정 | POST | `/api/ctl/smsUpdateUser` | CtlRestController | 관제담당자, 관제자 | 공지그룹 사용자 수정 |
| 공지그룹 사용자 삭제 | POST | `/api/ctl/smsUserDelete` | CtlRestController | 관제담당자, 관제자 | 공지그룹 사용자 삭제 |
| 공지 발송 규칙 목록 조회 | POST | `/api/ctl/smsList` | CtlRestController | 모든 권한 | 공지 발송 규칙 목록 조회 |
| 공지 발송 규칙 등록 | POST | `/api/ctl/insertSmsRule` | CtlRestController | 관제담당자, 관제자 | 공지 발송 규칙 등록 |
| 공지 발송 규칙 수정 | POST | `/api/ctl/smsUpdate` | CtlRestController | 관제담당자, 관제자 | 공지 발송 규칙 수정 |
| 공지 발송 규칙 삭제 | POST | `/api/ctl/smsDelete` | CtlRestController | 관제담당자, 관제자 | 공지 발송 규칙 삭제 |

---

## 필요한 데이터 (API 요청)

### 공지그룹 사용자 등록 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `zabbix_ip` | String | 이벤트 수집 IP | 필수 |
| `user_depart` | String | 그룹 | 필수 |
| `user_id` | String | 사번 | 필수 |
| `user_name` | String | 이름 | 필수 |
| `user_phone` | String | 전화번호 | 필수 |
| `user_email` | String | 이메일 | 선택 |

### 공지 발송 규칙 등록 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `zabbix_ip` | String | 이벤트 수집 IP | 필수 |
| `event_level` | String | 이벤트 등급 | 필수 |
| `sms_yn` | String | SMS 발송 여부 | 필수 |
| `email_yn` | String | Email 발송 여부 | 필수 |

---

## 데이터 흐름 다이어그램

```
[사용자 액션]
    │
    ├─► 사용자추가 버튼 클릭
    ├─► 발송규칙 추가 버튼 클릭
    ├─► 사용자 수정/삭제 버튼 클릭
    └─► 발송규칙 수정/삭제 버튼 클릭

    ▼

[API 호출]
    │
    ├─► POST /api/ctl/smsUserList
    │   └─► 공지그룹 사용자 목록
    │
    ├─► POST /api/ctl/smsList
    │   └─► 공지 발송 규칙 목록
    │
    ├─► POST /api/ctl/insertSmsUser
    │   └─► 공지그룹 사용자 등록
    │
    ├─► POST /api/ctl/insertSmsRule
    │   └─► 공지 발송 규칙 등록
    │
    └─► POST /api/ctl/smsUpdate, smsDelete 등
        └─► 공지그룹 사용자/발송규칙 수정/삭제

    ▼

[데이터베이스]
    │
    └─► CMON_SMS_USER, CMON_SMS_RULE 조회/수정
        ├─► 검색 조건 적용
        ├─► 페이징 처리
        └─► 사용자/규칙 정보 저장/수정/삭제

    ▼

[응답 데이터]
    │
    └─► JSON 응답
        ├─► list: 사용자/규칙 목록
        ├─► totalCount: 전체 건수
        └─► paging: 페이징 정보

    ▼

[화면 업데이트]
    │
    └─► 그리드 데이터 바인딩
        ├─► gridUser.resetData()
        └─► gridSms.resetData()
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `CtlController.java:84-95`
- **REST 컨트롤러**: `CtlRestController.java`

### Service
- **서비스 인터페이스**: `CtlService.java`
- **서비스 구현**: `CtlServiceImpl.java`

### Mapper
- **매퍼 인터페이스**: `CtlMapper.java`
- **SQL 매핑**: `sqlmap/CtlMapper.xml`

### JSP
- **메인 화면**: `WEB-INF/jsp/ctl/subControlContact.jsp`

---

## 작성일
2025-01-27

