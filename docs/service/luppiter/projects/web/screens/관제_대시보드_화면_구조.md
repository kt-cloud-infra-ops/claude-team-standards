# Luppiter Web - 관제 대시보드 화면 구조

## 개요

본 문서는 Luppiter Web의 **관제 대시보드** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/dashboard/manage`
- **JSP 파일**: `web/dashboard/manageMain.jsp`
- **Controller**: `DashboardController.java`
- **설명**: 관제 대시보드 화면

---

## 화면 구성 요소

### 1. 왼쪽 영역 (`wrap-service left`)

#### 표준서비스별 장애 발생현황 카드
- **카드 ID**: `service-list`
- **확장/축소 버튼**: `btn-up-down`
- **표준서비스별 장애 발생 현황 리스트**

#### 이벤트 발생 추이 차트 카드
- **차트 ID**: `chart-event`
- **기간 선택**: 2일, 3일, 7일 라디오 버튼
- **이벤트 발생 추이 차트**

#### 장애/이상징후 발생 추이 차트 카드
- **차트 ID**: `chart-incident`
- **장애/이상징후 발생 추이 차트**

### 2. 오른쪽 영역 (`wrap-service right`)

#### 인시던트 실시간 발생 건 카드
- **카드 ID**: `incident-status`
- **인시던트 실시간 발생 건수 표시**

#### 시계 카드
- **세로 배지**: `vertical-badge`
  - 연도: `year`
  - 월/일: `month-date`
  - 시간: `time`

#### Zabbix 연동 상태 카드
- **카드 ID**: `agent-status`
- **Zabbix 연동 상태 정보 표시**
- **비정상 기준**: 데이터 수집을 10분간 못하는 경우

#### 작업현황 캘린더 카드
- **캘린더 컨트롤**: `calendar-controls`
  - 이전 버튼: `prevBtn`
  - 오늘 버튼: `todayBtn`
  - 다음 버튼: `nextBtn`
  - 현재 날짜: `currentDate`
- **캘린더 영역**: `calendar`
- **작업 목록 표시**

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► DashboardController.viewManageMain()
        ├─► 공통코드 주입
        │   ├─► EVENT_COMBINE_STATUS
        │   └─► JOB_CODE (EVENT_WEB_FUNCTION)
        └─► manageMain.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► ManageDashboard.js 로드
        ├─► 차트 초기화
        │   ├─► 이벤트 발생 추이 차트
        │   └─► 인시던트 발생 추이 차트
        ├─► 캘린더 초기화
        └─► 데이터 조회 시작
```

#### 주요 코드 위치
- **컨트롤러**: `DashboardController.java:239-254`
- **JSP**: `web/dashboard/manageMain.jsp`

### 2단계: 데이터 조회

```
[표준서비스별 장애 발생현황 조회]
    │
    └─► fn_getStandardServiceList()
        └─► 표준서비스별 장애 발생 현황 리스트

    ▼

[인시던트 실시간 발생 건 조회]
    │
    └─► fn_getIncidentRealTimeStatus()
        └─► POST /dashboard/manage/incident/status

    ▼

[Zabbix 연동 상태 조회]
    │
    └─► fn_getAgentStatus()
        └─► Zabbix 연동 상태 정보

    ▼

[이벤트 발생 추이 차트 조회]
    │
    └─► fn_getChartData(incidentChart, 'incident', 30)
        └─► POST /dashboard/manage/chart/{dataType}

    ▼

[작업현황 조회]
    │
    └─► 캘린더에 작업 목록 표시
        └─► JOB_CODE 기반 작업 표시
```

#### 주요 코드 위치
- **JavaScript**: `js/custom/ManageDashboard.js`
- **API 엔드포인트**: `DashboardController.java:307-451`

### 3단계: 실시간 갱신

```
[60초 주기 자동 갱신]
    │
    └─► setInterval() 설정
        ├─► 표준서비스별 장애 발생현황 조회
        ├─► 인시던트 실시간 발생 건 조회
        ├─► Zabbix 연동 상태 조회
        └─► 인시던트 발생 추이 차트 조회
```

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 설명 |
|-----|--------|------------|------|
| 표준서비스 목록 조회 | POST | `/dashboard/manage/service/info` | 표준서비스 목록 조회 |
| 서비스 상세 정보 조회 | POST | `/dashboard/manage/service/popup/info` | 서비스 상세 정보 조회 |
| 작업현황 목록 조회 | POST | `/dashboard/manage/task/list` | 작업현황 목록 조회 |
| 인시던트 발생 현황 조회 | POST | `/dashboard/manage/incident/status` | 인시던트 발생 현황 조회 |
| 이벤트 수집상태 조회 | POST | `/dashboard/manage/event/status` | 이벤트 수집상태 조회 |
| 차트 데이터 조회 | POST | `/dashboard/manage/chart/{dataType}` | 차트 데이터 조회 (event, incident, service 등) |

---

## 필요한 데이터 (API 요청)

### 작업현황 목록 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `period_date` | String | 조회 기간 날짜 | 필수 |

### 차트 데이터 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `dataType` | String | 데이터 타입 (event, incident, service) | 필수 (Path Variable) |
| `data_range` | String | 데이터 범위 | 필수 |

### 서비스 상세 정보 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `service_code` | String | 서비스 코드 | 필수 |

---

## 데이터 흐름 다이어그램

```
[페이지 로드]
    │
    └─► JavaScript 초기화
        ├─► 차트 초기화
        ├─► 캘린더 초기화
        └─► 데이터 조회 시작

    ▼

[API 호출]
    │
    ├─► POST /dashboard/manage/service/info
    │   └─► 표준서비스 목록
    │
    ├─► POST /dashboard/manage/incident/status
    │   └─► 인시던트 실시간 발생 건
    │
    ├─► POST /dashboard/manage/event/status
    │   └─► 이벤트 수집상태
    │
    ├─► POST /dashboard/manage/chart/{dataType}
    │   └─► 차트 데이터
    │
    └─► POST /dashboard/manage/task/list
        └─► 작업현황 목록

    ▼

[화면 업데이트]
    │
    └─► 데이터 바인딩
        ├─► 표준서비스별 장애 발생현황 리스트
        ├─► 인시던트 실시간 발생 건수
        ├─► Zabbix 연동 상태
        ├─► 이벤트/인시던트 발생 추이 차트
        └─► 캘린더 작업 목록
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `DashboardController.java:239-254`
- **API 컨트롤러**: `DashboardController.java:307-451`

### Service
- **서비스**: `DashboardService.java`

### JSP
- **메인 화면**: `WEB-INF/jsp/web/dashboard/manageMain.jsp`
- **JavaScript**: `js/custom/ManageDashboard.js`
- **공통 JavaScript**: `js/custom/CommonDashboard.js`

---

## 참고 파일 목록

### Controller
- `src/main/java/com/framework/web/controller/DashboardController.java`

### Service
- `src/main/java/com/framework/web/service/DashboardService.java`

### JSP
- `src/main/webapp/WEB-INF/jsp/web/dashboard/manageMain.jsp`
- `src/main/webapp/WEB-INF/jsp/web/dashboard/popup/popServiceReport.jsp`

### JavaScript
- `src/main/webapp/js/custom/ManageDashboard.js`
- `src/main/webapp/js/custom/CommonDashboard.js`

---

## 작성일
2025-01-27

