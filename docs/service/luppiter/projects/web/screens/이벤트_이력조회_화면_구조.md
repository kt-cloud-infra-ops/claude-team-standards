# Luppiter Web - 이벤트 이력 조회 화면 구조

## 개요

본 문서는 Luppiter Web의 **이벤트 이력 조회** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/view/evt/subEventHistory`
- **JSP 파일**: `evt/subEventHistory.jsp`
- **Controller**: `EvtController.java`
- **REST Controller**: `EvtRestController.java`
- **설명**: 이벤트 이력 조회 화면

---

## 화면 구성 요소

### 1. 헤더 영역
- **제목**: 이벤트 이력 조회
- **기능 버튼**:
  - 소리끔/켬 버튼 (`btnSound`)
  - 엑셀다운로드 버튼 (`btnExcelDown`)
- **현재 시간 표시**: `printNowDateTime`

### 2. 실시간 조회 영역
- **실시간 체크박스**: `realCHK` (기본 체크됨, 숨김)
- **검색필터 체크박스**: `btnKeyword` (기본 체크됨)
- **현재 조회 시간 표시**: `currCheckTime`
- **지금 업데이트 버튼**: `btnReload`
- **컬럼선택 버튼**: 컬럼 표시/숨김 설정

### 3. 검색 필터 영역 (`divSearch`)
- **조회기간**:
  - 조회 타입 선택: `searchType` (이벤트 발생 시간/인지 시간/완료 시간)
  - 시작일/시간: `startDate`, `startTime`
  - 종료일/시간: `endDate`, `endTime`
  - 기간 선택 버튼: 1개월, 2개월, 3개월
- **레이어 필터**:
  - L1, L2, L3 선택: `commonL1`, `commonL2`, `commonL3`
  - Zone(L4): `zone`
- **이벤트 필터**:
  - 이벤트등급: `kwEventLevel` (Critical, Fatal)
  - 이벤트상태: `kwZabbixState` (신규, 지속, 해소)
  - 이벤트대응단계: `kwEventState` (신규, 인지, 조치중, 예외, 조치완료)
  - 인시던트: `kwIncidentId`
  - 인지자: `kwStep1User`
  - 조치자: `kwStep2User`
  - 이벤트제목: `kwEventContent`
  - 표준서비스명: `kwStdnm`
  - 단위서비스명: `kwEstdnm`
- **장비 정보 필터**:
  - 호스트명: `kwHostname`
  - 관제영역: `ctlArea`
  - 이벤트 수집 IP: `kwTargetIp`
  - 센터: `kwContainerNm`
  - 층/실: `kwDatacenterNm`
  - 상면정보: `kwRackLocation`
  - 이벤트ID: `kwEventId`
- **검색/초기화 버튼**: `btnSearch`, `btnSearchInit`

### 4. 그리드 영역
- **Toast UI Grid**: `grid`
- **페이지 크기 선택**: `slcPageSize` (20, 50, 75, 100, 200, 300, 전체)
- **페이징**: `divPaging`

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► EvtController.subEventHistory()
        └─► subEventHistory.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► 화면 초기화 함수 호출
        ├─► 그리드 초기화
        ├─► 첫 페이지 조회
        └─► 검색 필터 표시 (기본 체크됨)
```

#### 주요 코드 위치
- **컨트롤러**: `EvtController.java:98-108`
- **JSP**: `evt/subEventHistory.jsp`

### 2단계: 이벤트 이력 목록 조회

```
[조회 요청]
    │
    ├─► 검색 버튼 클릭 (btnSearch)
    │   └─► 이벤트 이력 목록 조회 함수 호출
    │
    └─► 지금 업데이트 버튼 (btnReload)
        └─► 이벤트 이력 목록 조회 함수 호출

    ▼

[API 호출]
    │
    └─► POST /api/evt/history/list
        ├─► 파라미터 구성
        │   ├─► 검색 조건 (조회기간, 필터 등)
        │   ├─► 페이지 정보 (pageNum, pageSize)
        │   └─► 정렬 정보
        │
        └─► 응답 데이터
            ├─► 이벤트 이력 목록 (list)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        ├─► gridObj["grid"].resetData(data.list)
        └─► 페이징 정보 업데이트
```

#### 주요 코드 위치
- **조회 함수**: `subEventHistory.jsp:이벤트 이력 목록 조회 함수`
- **API 호출**: `subEventHistory.jsp:fnAjax()`

### 3단계: 이벤트 이력 상세 조회

```
[그리드 행 클릭/더블클릭]
    │
    └─► 이벤트 상세 정보 조회
        └─► POST /api/evt/info
            ├─► eventId 파라미터 전달
            │
            └─► 이벤트 상세 정보 조회
                ├─► 이벤트 기본 정보
                ├─► 장비 정보
                ├─► 대응관리 정보
                └─► 이벤트 이력

    ▼

[팝업 표시]
    │
    └─► 이벤트 상세 팝업 오픈
        └─► 상세 정보 표시
```

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 설명 |
|-----|--------|------------|------|
| 이벤트 이력 목록 조회 | POST | `/api/evt/history/list` | 이벤트 이력 목록 조회 |
| 이벤트 상세 정보 조회 | POST | `/api/evt/info` | 이벤트 상세 정보 조회 |
| 이벤트 이력 엑셀 다운로드 | POST | `/api/evt/history/excellist` | 이벤트 이력 엑셀 다운로드 |
| 이벤트 이력 상세 엑셀 다운로드 | POST | `/api/evt/history/detailedExcellist` | 이벤트 이력 상세 엑셀 다운로드 |

---

## 필요한 데이터 (API 요청)

### 이벤트 이력 목록 조회 파라미터

이벤트 상황관리 화면과 동일한 검색 필터 파라미터를 사용합니다.

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `pageNum` | Integer | 페이지 번호 | 필수 |
| `pageSize` | Integer | 페이지 크기 | 필수 |
| `startDate` | String | 시작일 | 선택 |
| `startTime` | String | 시작시간 | 선택 |
| `endDate` | String | 종료일 | 선택 |
| `endTime` | String | 종료시간 | 선택 |
| `searchType` | String | 조회 타입 (evtOccu/evtChk/evtEnd) | 선택 |
| `commonL1` | String | L1 코드 | 선택 |
| `commonL2` | String | L2 코드 | 선택 |
| `commonL3` | String | L3 코드 | 선택 |
| `zone` | String | Zone(L4) | 선택 |
| `kwEventLevel` | String | 이벤트 등급 | 선택 |
| `kwZabbixState` | String | 이벤트 상태 | 선택 |
| `kwEventState` | String | 이벤트 대응단계 | 선택 |
| `kwIncidentId` | String | 인시던트 ID | 선택 |
| `kwStep1User` | String | 인지자 | 선택 |
| `kwStep2User` | String | 조치자 | 선택 |
| `kwEventContent` | String | 이벤트 제목 | 선택 |
| `kwStdnm` | String | 표준서비스명 | 선택 |
| `kwEstdnm` | String | 단위서비스명 | 선택 |
| `kwHostname` | String | 호스트명 | 선택 |
| `ctlArea` | String | 관제영역 | 선택 |
| `kwTargetIp` | String | 이벤트 수집 IP | 선택 |
| `kwContainerNm` | String | 센터 | 선택 |
| `kwDatacenterNm` | String | 층/실 | 선택 |
| `kwRackLocation` | String | 상면정보 | 선택 |
| `kwEventId` | String | 이벤트 ID | 선택 |

---

## 데이터 흐름 다이어그램

```
[사용자 액션]
    │
    ├─► 검색 버튼 클릭
    └─► 지금 업데이트 버튼

    ▼

[API 호출]
    │
    └─► POST /api/evt/history/list
        ├─► EvtRestController.historyList()
        │   └─► EvtService.selectEventHistoryList()
        │       └─► EvtMapper.selectEventHistoryList()
        │           └─► SQL 쿼리 실행

    ▼

[데이터베이스]
    │
    └─► CMON_EVENT_INFO 조회 (이력 데이터)
        ├─► 검색 조건 적용
        ├─► 페이징 처리
        └─► 정렬 처리

    ▼

[응답 데이터]
    │
    └─► JSON 응답
        ├─► list: 이벤트 이력 목록
        ├─► totalCount: 전체 건수
        └─► paging: 페이징 정보

    ▼

[화면 업데이트]
    │
    └─► 그리드 데이터 바인딩
        ├─► gridObj["grid"].resetData()
        └─► 페이징 정보 업데이트
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `EvtController.java:98-108`
- **REST 컨트롤러**: `EvtRestController.java`

### Service
- **서비스 인터페이스**: `EvtService.java`
- **서비스 구현**: `EvtServiceImpl.java`

### Mapper
- **매퍼 인터페이스**: `EvtMapper.java`
- **SQL 매핑**: `sqlmap/EvtMapper.xml`

### JSP
- **메인 화면**: `WEB-INF/jsp/evt/subEventHistory.jsp`

---

## 작성일
2025-01-27

