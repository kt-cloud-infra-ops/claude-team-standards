# Luppiter Web 테스트 가이드

## 현재 상태

### 프로젝트 환경
- **프레임워크**: Spring Boot 2.7.5 + MyBatis
- **테스트 프레임워크**: JUnit 5, Mockito, AssertJ
- **DB**: PostgreSQL

### 테스트 커버리지 현황

| 레이어 | 테스트 클래스 | 테스트 케이스 | 커버리지 |
|--------|:------------:|:------------:|:--------:|
| Service | 2개 | 91개 | 100% |
| Controller | 2개 | 19개 | 100% |
| Mapper | 2개 | 비활성화 | 0% |
| **Total** | **6개** | **118개** | - |

---

## 테스트 실행

```bash
# 전체 테스트 실행
mvn test

# 특정 클래스 실행
mvn test -Dtest=EvtServiceImplTest

# 특정 메서드 실행
mvn test -Dtest=EvtServiceImplTest#selectEventList_Success
```

---

## Service 테스트 작성법

### 기본 구조

```java
@ExtendWith(MockitoExtension.class)
@DisplayName("EvtService 단위 테스트")
class EvtServiceImplTest {

    @Mock
    private EvtMapper evtMapper;

    @InjectMocks
    private EvtServiceImpl evtService;

    @Test
    @DisplayName("이벤트 목록 조회 - 정상")
    void selectEventList_Success() {
        // Given
        Map<String, Object> params = new HashMap<>();
        params.put("pageNum", 1);
        params.put("pageSize", 20);

        List<Map<String, Object>> mockList = Arrays.asList(
            Map.of("eventId", "EVT001", "eventLevel", "2")
        );
        when(evtMapper.selectEventList(any())).thenReturn(mockList);

        // When
        List<Map<String, Object>> result = evtService.selectEventList(params);

        // Then
        assertThat(result).isNotNull();
        assertThat(result).hasSize(1);
        verify(evtMapper).selectEventList(any());
    }
}
```

### 예외 케이스 테스트

```java
@Test
@DisplayName("이벤트 목록 조회 - 파라미터 null")
void selectEventList_NullParams() {
    // Given
    when(evtMapper.selectEventList(null))
        .thenThrow(new RuntimeException("파라미터 오류"));

    // When & Then
    assertThrows(RuntimeException.class, () -> {
        evtService.selectEventList(null);
    });
}
```

---

## Controller 테스트 작성법

```java
@WebMvcTest(EvtRestController.class)
@DisplayName("EvtRestController 테스트")
class EvtRestControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private EvtService evtService;

    @Test
    @DisplayName("이벤트 목록 조회 API")
    void list_Success() throws Exception {
        // Given
        List<Map<String, Object>> mockList = Arrays.asList(
            Map.of("eventId", "EVT001")
        );
        when(evtService.selectEventList(any())).thenReturn(mockList);

        // When & Then
        mockMvc.perform(post("/api/evt/list")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"pageNum\":1,\"pageSize\":20}"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.list").isArray());
    }
}
```

---

## Mapper 테스트 (향후 적용)

### TestContainers 사용 (권장)

```java
@MybatisTest
@Testcontainers
@DisplayName("EvtMapper 통합 테스트")
class EvtMapperTest {

    @Container
    static PostgreSQLContainer<?> postgres =
        new PostgreSQLContainer<>("postgres:13");

    @Autowired
    private EvtMapper evtMapper;

    @Test
    void selectEventList_Integration() {
        // 실제 DB 쿼리 테스트
        Map<String, Object> params = Map.of("pageNum", 1, "pageSize", 10);
        List<Map<String, Object>> result = evtMapper.selectEventList(params);
        assertThat(result).isNotNull();
    }
}
```

---

## 테스트 데이터 관리

### TestDataBuilder 클래스

```java
public class TestDataBuilder {

    public static Map<String, Object> buildEventParams() {
        Map<String, Object> params = new HashMap<>();
        params.put("pageNum", 1);
        params.put("pageSize", 20);
        params.put("kwEventLevel", "2");
        return params;
    }

    public static Map<String, Object> buildIncidentParams() {
        Map<String, Object> params = new HashMap<>();
        params.put("incidentId", "ICD001");
        return params;
    }
}
```

---

## 테스트 파일 위치

```
src/test/java/com/framework/
├── evt/
│   ├── controller/EvtRestControllerTest.java
│   ├── service/EvtServiceImplTest.java
│   └── mapper/EvtMapperTest.java (비활성화)
├── icd/
│   ├── controller/IcdRestControllerTest.java
│   ├── service/IcdServiceImplTest.java
│   └── mapper/IcdMapperTest.java (비활성화)
└── test/
    ├── TestDataBuilder.java
    └── TestTemplate.java
```

---

## 개선 계획

1. **Mapper 테스트 활성화**: TestContainers 적용
2. **E2E 테스트**: Playwright 도입
3. **CI/CD 통합**: GitHub Actions 연동

---

**최종 업데이트**: 2026-01-30
