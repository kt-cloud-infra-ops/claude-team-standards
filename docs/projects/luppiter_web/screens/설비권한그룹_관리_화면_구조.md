# Luppiter Web - 설비권한그룹 관리 화면 구조

## 개요

본 문서는 Luppiter Web의 **설비권한그룹 관리** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/view/ctl/subControlLayerCode`
- **JSP 파일**: `ctl/subControlLayerCode.jsp`
- **Controller**: `CtlController.java`
- **REST Controller**: `CtlRestController.java`
- **설명**: 관제 운영 관리 > 설비권한그룹 관리

---

## 화면 구성 요소

### 1. 헤더 영역
- **제목**: 설비권한그룹 관리
- **기능 버튼**:
  - 엑셀다운로드 버튼: `btnExcelDownload`

### 2. 왼쪽 패널 (`panel`, width:28%)
- **제목**: 설비권한그룹
- **Toast UI Grid**: `gridGroup`
- **액션 버튼**:
  - 조회: `btnInquiry`
  - 이력조회: `btnHistory`

### 3. 오른쪽 패널 (`panel`, width:72%)
- **제목**: 설비권한그룹코드
- **액션 버튼**:
  - 수정: `btnEdit`
- **검색 필터 영역**:
  - L1, L2, L3 선택: `L1`, `L2`, `L3`
  - Zone: `zone`
  - 관제영역: `ctlArea`
  - 호스트그룹명: `host_group_nm`
  - 검색/초기화 버튼: `btnSearch`, `btnSearchInit`
- **Toast UI Grid**: `gridLayer`
- **페이지 크기 선택**: `slcPageSize` (20, 50, 75, 100, 200, 300, 전체)
- **페이징**: `divPaging`

### 4. 팝업
- **호스트그룹 조회 팝업**: `inquiryHostGroupPopup` (`subControlLayerCodeHostGroupPop.jsp`)
- **이력조회 팝업**: `hostGroupHistoryPopup` (`subControlLayerCodeHistoryPop.jsp`)
- **수정 팝업**: `subControlLayerCodePopup` (`subControlLayerCodePopup.jsp`)
- **설비권한그룹 저장 confirm 팝업**: `subControlLayerCodeConfirm` (`subControlLayerCodeConfirm.jsp`)

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► CtlController.subControlLayerCode()
        └─► subControlLayerCode.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► 화면 초기화 함수 호출
        ├─► 설비권한그룹 그리드 초기화
        ├─► 설비권한그룹코드 그리드 초기화
        └─► 첫 페이지 조회
```

#### 주요 코드 위치
- **컨트롤러**: `CtlController.java:122-133`
- **JSP**: `ctl/subControlLayerCode.jsp`

### 2단계: 설비권한그룹 목록 조회

```
[조회 요청]
    │
    ├─► 조회 버튼 클릭 (btnInquiry)
    │   └─► 설비권한그룹 목록 조회 함수 호출
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/ctl/layerCodeGroupList
        ├─► 파라미터 구성
        │   └─► 페이지 정보 (pageNum, pageSize)
        │
        └─► 응답 데이터
            ├─► 설비권한그룹 목록 (list)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        └─► gridGroup.resetData(data.list)
```

#### 주요 코드 위치
- **조회 함수**: `subControlLayerCode.jsp:설비권한그룹 목록 조회 함수`
- **API 호출**: `CtlRestController.java:layerCodeGroupList API`

### 3단계: 설비권한그룹코드 목록 조회

```
[조회 요청]
    │
    ├─► 검색 버튼 클릭 (btnSearch)
    │   └─► 설비권한그룹코드 목록 조회 함수 호출
    │
    ├─► 설비권한그룹 선택 시
    │   └─► 선택된 그룹의 설비권한그룹코드 목록 조회
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/ctl/layerCodeList
        ├─► 파라미터 구성
        │   ├─► 그룹 ID
        │   ├─► 검색 조건 (L1, L2, L3, zone, 관제영역, 호스트그룹명)
        │   ├─► 페이지 정보 (pageNum, pageSize)
        │   └─► 정렬 정보
        │
        └─► 응답 데이터
            ├─► 설비권한그룹코드 목록 (list)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        └─► gridLayer.resetData(data.list)
```

#### 주요 코드 위치
- **조회 함수**: `subControlLayerCode.jsp:설비권한그룹코드 목록 조회 함수`
- **API 호출**: `CtlRestController.java:layerCodeList API`

### 4단계: 설비권한그룹코드 수정

```
[수정 버튼 클릭]
    │
    └─► btnEdit 클릭
        └─► 수정 팝업 오픈
            └─► subControlLayerCodePopup.jsp

    ▼

[설비권한그룹코드 수정 처리]
    │
    └─► POST /api/ctl/layerCodeUpdate
        ├─► 설비권한그룹코드 정보 수정
        │   ├─► L1, L2, L3, Zone 정보
        │   ├─► 호스트그룹 정보
        │   └─► 관제영역 정보
        │
        └─► 수정 완료
            └─► 목록 새로고침
```

#### 주요 코드 위치
- **수정 처리**: `CtlRestController.java:layerCodeUpdate API`
- **서비스**: `CtlService.updateLayerCode()`

### 5단계: 이력 조회

```
[이력조회 버튼 클릭]
    │
    └─► btnHistory 클릭
        └─► 이력조회 팝업 오픈
            └─► subControlLayerCodeHistoryPop.jsp
                └─► POST /api/ctl/layerCodeHistory
                    └─► 설비권한그룹 이력 조회
```

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 컨트롤러 | 권한 | 설명 |
|-----|--------|------------|----------|------|------|
| 설비권한그룹 목록 조회 | POST | `/api/ctl/layerCodeGroupList` | CtlRestController | 모든 권한 | 설비권한그룹 목록 조회 |
| 설비권한그룹코드 목록 조회 | POST | `/api/ctl/layerCodeList` | CtlRestController | 모든 권한 | 설비권한그룹코드 목록 조회 |
| 설비권한그룹코드 수정 | POST | `/api/ctl/layerCodeUpdate` | CtlRestController | 관제담당자, 관제자 | 설비권한그룹코드 수정 |
| 설비권한그룹 이력 조회 | POST | `/api/ctl/layerCodeHistory` | CtlRestController | 모든 권한 | 설비권한그룹 이력 조회 |
| 호스트그룹 조회 | POST | `/api/ctl/hostGroupList` | CtlRestController | 모든 권한 | 호스트그룹 목록 조회 |

---

## 필요한 데이터 (API 요청)

### 설비권한그룹코드 목록 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `pageNum` | Integer | 페이지 번호 | 필수 |
| `pageSize` | Integer | 페이지 크기 | 필수 |
| `groupId` | String | 그룹 ID | 선택 |
| `L1` | String | L1 코드 | 선택 |
| `L2` | String | L2 코드 | 선택 |
| `L3` | String | L3 코드 | 선택 |
| `zone` | String | Zone | 선택 |
| `ctlArea` | String | 관제영역 | 선택 |
| `host_group_nm` | String | 호스트그룹명 | 선택 |

### 설비권한그룹코드 수정 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `layerCodeId` | String | 설비권한그룹코드 ID | 필수 |
| `L1` | String | L1 코드 | 필수 |
| `L2` | String | L2 코드 | 필수 |
| `L3` | String | L3 코드 | 필수 |
| `zone` | String | Zone | 선택 |
| `host_group_nm` | String | 호스트그룹명 | 필수 |
| `ctlArea` | String | 관제영역 | 선택 |

---

## 데이터 흐름 다이어그램

```
[사용자 액션]
    │
    ├─► 조회 버튼 클릭
    ├─► 검색 버튼 클릭
    ├─► 설비권한그룹 선택
    ├─► 수정 버튼 클릭
    └─► 이력조회 버튼 클릭

    ▼

[API 호출]
    │
    ├─► POST /api/ctl/layerCodeGroupList
    │   └─► 설비권한그룹 목록
    │
    ├─► POST /api/ctl/layerCodeList
    │   └─► 설비권한그룹코드 목록
    │
    ├─► POST /api/ctl/layerCodeUpdate
    │   └─► 설비권한그룹코드 수정
    │
    └─► POST /api/ctl/layerCodeHistory
        └─► 설비권한그룹 이력

    ▼

[데이터베이스]
    │
    └─► CMON_LAYER_CODE_INFO 조회/수정
        ├─► 검색 조건 적용
        ├─► 페이징 처리
        └─► 설비권한그룹코드 정보 수정

    ▼

[응답 데이터]
    │
    └─► JSON 응답
        ├─► list: 설비권한그룹/코드 목록
        ├─► totalCount: 전체 건수
        └─► paging: 페이징 정보

    ▼

[화면 업데이트]
    │
    └─► 그리드 데이터 바인딩
        ├─► gridGroup.resetData()
        └─► gridLayer.resetData()
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `CtlController.java:122-133`
- **REST 컨트롤러**: `CtlRestController.java`

### Service
- **서비스 인터페이스**: `CtlService.java`
- **서비스 구현**: `CtlServiceImpl.java`

### Mapper
- **매퍼 인터페이스**: `CtlMapper.java`
- **SQL 매핑**: `sqlmap/CtlMapper.xml`

### JSP
- **메인 화면**: `WEB-INF/jsp/ctl/subControlLayerCode.jsp`
- **호스트그룹 팝업**: `WEB-INF/jsp/ctl/subControlLayerCodeHostGroupPop.jsp`
- **이력 팝업**: `WEB-INF/jsp/ctl/subControlLayerCodeHistoryPop.jsp`
- **수정 팝업**: `WEB-INF/jsp/ctl/subControlLayerCodePopup.jsp`
- **확인 팝업**: `WEB-INF/jsp/ctl/subControlLayerCodeConfirm.jsp`

---

## 작성일
2025-01-27

