# Luppiter Web - 관제대상 삭제 화면 구조

## 개요

본 문서는 Luppiter Web의 **관제대상 삭제** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/view/mng/delHosts`
- **JSP 파일**: `mng/deleteHosts.jsp`
- **Controller**: `InventoryManagerController.java`
- **설명**: 관제 대상관리 > 관제대상 삭제

---

## 화면 구성 요소

### 1. 헤더 영역
- **제목**: 관제 대상 삭제

### 2. 검색 필터 영역 (`search`)
- **레이어 필터**:
  - L1, L2, L3 선택: `commonL1`, `commonL2`, `commonL3`
  - Zone: `searchZone`
- **호스트 정보**:
  - Host Name: `searchHostName`
  - Host IP: `searchHostIP`
- **등록 정보**:
  - 등록자명/ID: `searchRegUser`
  - 요청 제목: `searchTitle`
  - 등록일: `searchStartDate`, `searchEndDate`
- **검색/초기화 버튼**: `btnSearch`, `btRefresh`

### 3. 그리드 영역
- **Toast UI Grid**: `grid`
- **페이지 크기 선택**: `slcPageSize` (20, 50, 75, 100, 200, 300, 전체)
- **액션 버튼**:
  - 등록: `btnInsert`
- **페이징**: `divPaging`

### 4. 팝업
- **관제대상 삭제 등록 팝업**: `popupHostsRegist` (`popupHostsRegist.jsp`)
- **관제대상 삭제 이력 팝업**: `popupHostsHistory` (`popupHostsHistory.jsp`)
- **삭제 확인 팝업**: `deleteConfirm` (`ConfirmMessage.jsp`)
- **알림 팝업**: `alertConfirm` (`AlertMessage.jsp`)
- **장비 추가 팝업**: `subMaintenanceDeviceAdd` (`subMaintenanceDeviceAdd.jsp`)

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► InventoryManagerController.deleteHosts()
        └─► deleteHosts.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► 화면 초기화 함수 호출
        ├─► 그리드 초기화
        └─► 첫 페이지 조회
```

#### 주요 코드 위치
- **컨트롤러**: `InventoryManagerController.java:34-45`
- **JSP**: `mng/deleteHosts.jsp`

### 2단계: 관제대상 삭제 목록 조회

```
[조회 요청]
    │
    ├─► 검색 버튼 클릭 (btnSearch)
    │   └─► 관제대상 삭제 목록 조회 함수 호출
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/mng/hostsMng/list
        ├─► 파라미터 구성
        │   ├─► 검색 조건 (L1, L2, L3, Zone, Host Name, Host IP, 등록자, 요청 제목, 등록일)
        │   ├─► 페이지 정보 (pageNum, pageSize)
        │   └─► 정렬 정보
        │
        └─► 응답 데이터
            ├─► 관제대상 삭제 목록 (hostsManageMstList)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        ├─► gridObj["grid"].resetData(data.hostsManageMstList)
        └─► 페이징 정보 업데이트
```

#### 주요 코드 위치
- **조회 함수**: `deleteHosts.jsp:관제대상 삭제 목록 조회 함수`
- **API 호출**: `InventoryManagerController.java:47-63`

### 3단계: 관제대상 삭제 등록

```
[등록 버튼 클릭]
    │
    └─► btnInsert 클릭
        └─► 관제대상 삭제 등록 팝업 오픈
            └─► popupHostsRegist.jsp

    ▼

[관제대상 삭제 등록 처리]
    │
    └─► POST /api/mng/hostsMng/remove
        ├─► 삭제 요청 정보 입력
        │   ├─► 요청 제목
        │   ├─► 삭제 사유
        │   └─► 대상 호스트 목록
        │
        └─► 삭제 처리
            ├─► 1. 삭제요청 정보 저장
            │   ├─► cmon_manage_hosts_mst
            │   ├─► cmon_manage_hosts_detail
            │   └─► cmon_manage_hosts_history
            │
            ├─► 2. 대상 호스트 Disabled 처리 (to Zabbix-API)
            │
            └─► 3. 대상 호스트 삭제 처리 (to Zabbix-API)
                └─► 목록 새로고침
```

#### 주요 코드 위치
- **등록 처리**: `InventoryManagerController.java:74-105`
- **서비스**: `InventoryManagerService.putHostManageInfo()`, `removeZabbixHostForLIB()`

### 4단계: 관제대상 삭제 이력 조회

```
[이력조회 버튼 클릭]
    │
    └─► 이력조회 팝업 오픈
        └─► popupHostsHistory.jsp
            └─► POST /api/mng/hostsMng/history
                └─► 관제대상 삭제 이력 조회
```

#### 주요 코드 위치
- **이력 조회**: `InventoryManagerController.java:107-123`

### 5단계: 상세 목록 조회

```
[그리드 행 클릭]
    │
    └─► 선택된 삭제 요청의 상세 목록 조회
        └─► POST /api/mng/hostsMng/detailList
            └─► 관제대상 삭제 상세 목록 조회
```

#### 주요 코드 위치
- **상세 목록 조회**: `InventoryManagerController.java:125-138`

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 컨트롤러 | 권한 | 설명 |
|-----|--------|------------|----------|------|------|
| 관제대상 삭제 목록 조회 | POST | `/api/mng/hostsMng/list` | InventoryManagerController | 모든 권한 | 관제대상 삭제 목록 조회 |
| 관제대상 삭제 처리 | POST | `/api/mng/hostsMng/remove` | InventoryManagerController | 관제담당자, 관제자 | 관제대상 삭제 처리 |
| 관제대상 삭제 이력 조회 | POST | `/api/mng/hostsMng/history` | InventoryManagerController | 모든 권한 | 관제대상 삭제 이력 조회 |
| 관제대상 삭제 상세 목록 조회 | POST | `/api/mng/hostsMng/detailList` | InventoryManagerController | 모든 권한 | 관제대상 삭제 상세 목록 조회 |

---

## 필요한 데이터 (API 요청)

### 관제대상 삭제 목록 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `pageNum` | Integer | 페이지 번호 | 필수 |
| `pageSize` | Integer | 페이지 크기 | 필수 |
| `commonL1` | String | L1 코드 | 선택 |
| `commonL2` | String | L2 코드 | 선택 |
| `commonL3` | String | L3 코드 | 선택 |
| `searchZone` | String | Zone | 선택 |
| `searchHostName` | String | Host Name | 선택 |
| `searchHostIP` | String | Host IP | 선택 |
| `searchRegUser` | String | 등록자명/ID | 선택 |
| `searchTitle` | String | 요청 제목 | 선택 |
| `searchStartDate` | String | 등록일 시작 | 선택 |
| `searchEndDate` | String | 등록일 종료 | 선택 |

### 관제대상 삭제 처리 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `requestType` | String | 요청 타입 (DEL) | 필수 |
| `title` | String | 요청 제목 | 필수 |
| `reason` | String | 삭제 사유 | 필수 |
| `hostList` | Array | 대상 호스트 목록 | 필수 |
| `hostList[].hostId` | String | 호스트 ID | 필수 |
| `hostList[].hostname` | String | 호스트명 | 필수 |
| `hostList[].ip` | String | IP | 필수 |

---

## 데이터 흐름 다이어그램

```
[사용자 액션]
    │
    ├─► 검색 버튼 클릭
    ├─► 등록 버튼 클릭
    ├─► 이력조회 버튼 클릭
    └─► 그리드 행 클릭 (상세 목록 조회)

    ▼

[API 호출]
    │
    ├─► POST /api/mng/hostsMng/list
    │   └─► InventoryManagerController.getHostsManageMstList()
    │       └─► InventoryManagerService.getHostManageMstList()
    │
    ├─► POST /api/mng/hostsMng/remove
    │   └─► InventoryManagerController.removeHostsManage()
    │       ├─► InventoryManagerService.putHostManageInfo()
    │       └─► InventoryManagerService.removeZabbixHostForLIB()
    │
    ├─► POST /api/mng/hostsMng/history
    │   └─► InventoryManagerController.getHostsManageHistoryList()
    │       └─► InventoryManagerService.getHostManageHistoryList()
    │
    └─► POST /api/mng/hostsMng/detailList
        └─► InventoryManagerController.getHostsManageDetailList()
            └─► InventoryManagerService.getHostManageDetailList()

    ▼

[데이터베이스]
    │
    └─► CMON_MANAGE_HOSTS_MST, CMON_MANAGE_HOSTS_DETAIL, CMON_MANAGE_HOSTS_HISTORY 조회/수정
        ├─► 검색 조건 적용
        ├─► 페이징 처리
        └─► 삭제 요청 정보 저장

    ▼

[Zabbix API 호출]
    │
    └─► 호스트 Disabled 처리 및 삭제 처리
        └─► Zabbix API 호출

    ▼

[응답 데이터]
    │
    └─► JSON 응답
        ├─► hostsManageMstList: 관제대상 삭제 목록
        ├─► totalCount: 전체 건수
        └─► paging: 페이징 정보

    ▼

[화면 업데이트]
    │
    └─► 그리드 데이터 바인딩
        ├─► gridObj["grid"].resetData()
        └─► 페이징 정보 업데이트
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `InventoryManagerController.java:34-45`
- **API 컨트롤러**: `InventoryManagerController.java:47-177`

### Service
- **서비스 인터페이스**: `InventoryManagerService.java`
- **서비스 구현**: `InventoryManagerServiceImpl.java`

### Mapper
- **매퍼 인터페이스**: `InventoryManageMapper.java`
- **SQL 매핑**: `sqlmap/InventoryManageMapper.xml`

### JSP
- **메인 화면**: `WEB-INF/jsp/mng/deleteHosts.jsp`
- **등록 팝업**: `WEB-INF/jsp/mng/popupHostsRegist.jsp`
- **이력 팝업**: `WEB-INF/jsp/mng/popupHostsHistory.jsp`

---

## 작성일
2025-01-27

