# Luppiter Web - 메인터넌스 관리 화면 구조

## 개요

본 문서는 Luppiter Web의 **메인터넌스 관리** 화면의 구조와 처리 흐름을 설명합니다.

---

## 화면 정보

- **URL**: `/view/zab/subMaintenanceInfo`
- **JSP 파일**: `zab/subMaintenanceInfo.jsp`
- **Controller**: `ZabController.java`
- **REST Controller**: `ZabRestController.java`
- **설명**: 관제 대상관리 > 메인터넌스 관리

---

## 화면 구성 요소

### 1. 헤더 영역
- **제목**: 메인터넌스 관리

### 2. 실시간 조회 영역
- **현재 조회 시간 표시**: `currCheckTime`
- **지금 업데이트 버튼**: `btnReload`

### 3. 검색 필터 영역 (`search`)
- **메인터넌스 정보**:
  - 메인터넌스ID: `inputMaintenanceId`
  - 메인터넌스명: `inputMtnNm`
  - 시작일: `inMainMtncStartDate`
  - 종료일: `inMainMtncEndDate`
- **등록자/상태 정보**:
  - 등록자: `inputMtnRegistNm`
  - 메인터넌스 상태: `inputMtnSts` (활성, 대기중, 종료, 실패)
  - 호스트: `inputHostName`
  - IP: `inputZabbixIp`
  - 설비바코드: `inputBarcode`
- **검색/초기화 버튼**: `btnSearch`, `btRefresh`

### 4. 그리드 영역
- **Toast UI Grid**: `grid`
- **페이지 크기 선택**: `slcPageSize` (20, 50, 75, 100, 200, 300, 전체)
- **액션 버튼**:
  - 등록: `btnInsert`
- **페이징**: `divPaging`

### 5. 팝업
- **메인터넌스 등록 팝업**: `subMaintenanceRegistPop` (`subMaintenanceRegistPop.jsp`)
- **메인터넌스 수정 팝업**: `subMaintenanceUpdatePop` (`subMaintenanceUpdatePop.jsp`)
- **메인터넌스 이력확인 팝업**: `subMaintenanceHistoryPop` (`subMaintenanceHistoryPop.jsp`)
- **메인터넌스 대상 추가 팝업**: `subMaintenanceDeviceAdd` (`subMaintenanceDeviceAdd.jsp`)

---

## 처리 흐름

### 1단계: 화면 초기화

```
[페이지 로드]
    │
    └─► ZabController.subMaintenanceInfo()
        └─► subMaintenanceInfo.jsp 렌더링

    ▼

[JavaScript 초기화]
    │
    └─► 화면 초기화 함수 호출
        ├─► 그리드 초기화
        ├─► 실시간 시간 업데이트
        └─► 첫 페이지 조회
```

#### 주요 코드 위치
- **컨트롤러**: `ZabController.java:26-37`
- **JSP**: `zab/subMaintenanceInfo.jsp`

### 2단계: 메인터넌스 목록 조회

```
[조회 요청]
    │
    ├─► 검색 버튼 클릭 (btnSearch)
    │   └─► 메인터넌스 목록 조회 함수 호출
    │
    ├─► 지금 업데이트 버튼 (btnReload)
    │   └─► 메인터넌스 목록 조회 함수 호출
    │
    └─► 페이지 로드 시 자동 조회

    ▼

[API 호출]
    │
    └─► POST /api/zab/selectMaintenanceInfoList
        ├─► 파라미터 구성
        │   ├─► 검색 조건 (메인터넌스ID, 메인터넌스명, 기간, 등록자, 상태, 호스트, IP, 설비바코드)
        │   ├─► 페이지 정보 (pageNum, pageSize)
        │   └─► 정렬 정보
        │
        └─► 응답 데이터
            ├─► 메인터넌스 목록 (maintenanceInfoList)
            ├─► 전체 건수 (totalCount)
            └─► 페이징 정보

    ▼

[데이터 바인딩]
    │
    └─► 그리드 데이터 설정
        ├─► gridObj["grid"].resetData(data.maintenanceInfoList)
        └─► 페이징 정보 업데이트
```

#### 주요 코드 위치
- **조회 함수**: `subMaintenanceInfo.jsp:메인터넌스 목록 조회 함수`
- **API 호출**: `ZabRestController.java:104-133`

### 3단계: 메인터넌스 등록

```
[등록 버튼 클릭]
    │
    └─► btnInsert 클릭
        └─► 메인터넌스 등록 팝업 오픈
            └─► subMaintenanceRegistPop.jsp

    ▼

[메인터넌스 등록 처리]
    │
    └─► POST /api/zab/insertMaintenanceInfo
        ├─► 메인터넌스 정보 입력
        │   ├─► 메인터넌스명
        │   ├─► 시작일시, 종료일시
        │   ├─► 메인터넌스 사유
        │   └─► 대상 장비 목록
        │
        └─► 등록 완료
            └─► 목록 새로고침
```

#### 주요 코드 위치
- **등록 처리**: `ZabRestController.java:insertMaintenanceInfo API`
- **서비스**: `ZabService.insertMaintenanceInfo()`

### 4단계: 메인터넌스 수정

```
[그리드 행의 수정 버튼 클릭]
    │
    └─► 메인터넌스 수정 팝업 오픈
        └─► subMaintenanceUpdatePop.jsp

    ▼

[메인터넌스 수정 처리]
    │
    └─► POST /api/zab/updateMaintenanceInfo
        ├─► 메인터넌스 정보 수정
        │   ├─► 메인터넌스명
        │   ├─► 시작일시, 종료일시
        │   ├─► 메인터넌스 사유
        │   └─► 대상 장비 목록
        │
        └─► 수정 완료
            └─► 목록 새로고침
```

#### 주요 코드 위치
- **수정 처리**: `ZabRestController.java:updateMaintenanceInfo API`
- **서비스**: `ZabService.updateMaintenanceInfo()`

### 5단계: 메인터넌스 삭제

```
[그리드 행의 삭제 버튼 클릭]
    │
    └─► 삭제 확인
        └─► POST /api/zab/deleteMaintenanceInfo
            ├─► 메인터넌스 ID 전달
            │
            └─► 메인터넌스 삭제 처리
                └─► 목록 새로고침
```

---

## 주요 API 엔드포인트

| API | 메서드 | 엔드포인트 | 컨트롤러 | 권한 | 설명 |
|-----|--------|------------|----------|------|------|
| 메인터넌스 목록 조회 | POST | `/api/zab/selectMaintenanceInfoList` | ZabRestController | 모든 권한 | 메인터넌스 목록 조회 |
| 메인터넌스 등록 | POST | `/api/zab/insertMaintenanceInfo` | ZabRestController | 관제담당자, 관제자 | 메인터넌스 등록 |
| 메인터넌스 수정 | POST | `/api/zab/updateMaintenanceInfo` | ZabRestController | 관제담당자, 관제자 | 메인터넌스 수정 |
| 메인터넌스 삭제 | POST | `/api/zab/deleteMaintenanceInfo` | ZabRestController | 관제담당자, 관제자 | 메인터넌스 삭제 |
| 메인터넌스 이력 조회 | POST | `/api/zab/selectMaintenanceHistory` | ZabRestController | 모든 권한 | 메인터넌스 이력 조회 |
| 사용 장비 목록 조회 | POST | `/api/zab/useDeviceMappingList` | ZabRestController | 모든 권한 | 사용 장비 목록 조회 |

---

## 필요한 데이터 (API 요청)

### 메인터넌스 목록 조회 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `pageNum` | Integer | 페이지 번호 | 필수 |
| `pageSize` | Integer | 페이지 크기 | 필수 |
| `inputMaintenanceId` | String | 메인터넌스ID | 선택 |
| `inputMtnNm` | String | 메인터넌스명 | 선택 |
| `inMainMtncStartDate` | String | 시작일 | 선택 |
| `inMainMtncEndDate` | String | 종료일 | 선택 |
| `inputMtnRegistNm` | String | 등록자 | 선택 |
| `inputMtnSts` | String | 메인터넌스 상태 | 선택 |
| `inputHostName` | String | 호스트 | 선택 |
| `inputZabbixIp` | String | IP | 선택 |
| `inputBarcode` | String | 설비바코드 | 선택 |

### 메인터넌스 등록 파라미터

| 필드명 | 타입 | 설명 | 필수 여부 |
|--------|------|------|-----------|
| `maintenanceNm` | String | 메인터넌스명 | 필수 |
| `startDate` | String | 시작일 | 필수 |
| `startTime` | String | 시작시간 | 필수 |
| `endDate` | String | 종료일 | 필수 |
| `endTime` | String | 종료시간 | 필수 |
| `reason` | String | 메인터넌스 사유 | 필수 |
| `deviceList` | Array | 대상 장비 목록 | 필수 |

---

## 데이터 흐름 다이어그램

```
[사용자 액션]
    │
    ├─► 검색 버튼 클릭
    ├─► 지금 업데이트 버튼 클릭
    ├─► 등록 버튼 클릭
    ├─► 수정 버튼 클릭
    └─► 삭제 버튼 클릭

    ▼

[API 호출]
    │
    ├─► POST /api/zab/selectMaintenanceInfoList
    │   └─► ZabRestController.selectMaintenanceInfoList()
    │       └─► ZabService.selectMaintenanceInfoList()
    │
    ├─► POST /api/zab/insertMaintenanceInfo
    │   └─► ZabRestController.insertMaintenanceInfo()
    │       └─► ZabService.insertMaintenanceInfo()
    │
    ├─► POST /api/zab/updateMaintenanceInfo
    │   └─► ZabRestController.updateMaintenanceInfo()
    │       └─► ZabService.updateMaintenanceInfo()
    │
    └─► POST /api/zab/deleteMaintenanceInfo
        └─► ZabRestController.deleteMaintenanceInfo()
            └─► ZabService.deleteMaintenanceInfo()

    ▼

[데이터베이스]
    │
    └─► CMON_MAINTENANCE_INFO 조회/수정
        ├─► 검색 조건 적용
        ├─► 페이징 처리
        └─► 메인터넌스 정보 저장/수정/삭제

    ▼

[응답 데이터]
    │
    └─► JSON 응답
        ├─► maintenanceInfoList: 메인터넌스 목록
        ├─► totalCount: 전체 건수
        └─► paging: 페이징 정보

    ▼

[화면 업데이트]
    │
    └─► 그리드 데이터 바인딩
        ├─► gridObj["grid"].resetData()
        └─► 페이징 정보 업데이트
```

---

## 주요 코드 위치

### Controller
- **화면 컨트롤러**: `ZabController.java:26-37`
- **REST 컨트롤러**: `ZabRestController.java`

### Service
- **서비스 인터페이스**: `ZabService.java`
- **서비스 구현**: `ZabServiceImpl.java`

### Mapper
- **매퍼 인터페이스**: `ZabMapper.java`
- **SQL 매핑**: `sqlmap/ZabMapper.xml`

### JSP
- **메인 화면**: `WEB-INF/jsp/zab/subMaintenanceInfo.jsp`
- **등록 팝업**: `WEB-INF/jsp/zab/subMaintenanceRegistPop.jsp`
- **수정 팝업**: `WEB-INF/jsp/zab/subMaintenanceUpdatePop.jsp`
- **이력 팝업**: `WEB-INF/jsp/zab/subMaintenanceHistoryPop.jsp`
- **대상 추가 팝업**: `WEB-INF/jsp/zab/subMaintenanceDeviceAdd.jsp`

---

## 작성일
2025-01-27

